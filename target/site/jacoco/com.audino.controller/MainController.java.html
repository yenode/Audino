<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MainController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Audino: Intelligent Prescription Manager</a> &gt; <a href="index.source.html" class="el_package">com.audino.controller</a> &gt; <span class="el_source">MainController.java</span></div><h1>MainController.java</h1><pre class="source lang-java linenums">package com.audino.controller;

import com.audino.model.*;
import com.audino.service.DataService;
import com.audino.service.InteractionEngine;
import javafx.application.Platform;
import javafx.beans.property.SimpleStringProperty;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.fxml.Initializable;
import javafx.scene.Scene;
import javafx.scene.control.*;
import javafx.scene.control.cell.PropertyValueFactory;
import javafx.scene.layout.GridPane;
import javafx.scene.layout.VBox;
import javafx.stage.Modality;
import javafx.stage.Stage;
import javafx.util.Callback;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.List;

import java.io.IOException;
import java.net.URL;
import java.util.ResourceBundle;
import java.util.concurrent.CompletableFuture;


<span class="nc" id="L31">public class MainController implements Initializable {</span>

    // FXML Controls - Header
    @FXML private Label currentDateLabel;

    // FXML Controls - Patient Section
    @FXML private TextField patientSearchField;
    @FXML private Button searchBtn;
    @FXML private ListView&lt;Patient&gt; patientListView;

    // FXML Controls - Prescription Builder Section
    @FXML private Label selectedPatientLabel;
    @FXML private Label patientIdLabel;
    @FXML private Label patientAgeLabel;
    @FXML private Label patientGenderLabel;
    @FXML private Label patientAllergiesLabel;
    @FXML private Label patientConditionsLabel;
    @FXML private Label medicationCountLabel;
    @FXML private TableView&lt;PrescribedDrug&gt; prescriptionTableView;
    @FXML private TableColumn&lt;PrescribedDrug, String&gt; medicationColumn;
    @FXML private TableColumn&lt;PrescribedDrug, String&gt; dosageColumn;
    @FXML private TableColumn&lt;PrescribedDrug, String&gt; frequencyColumn;
    @FXML private TableColumn&lt;PrescribedDrug, String&gt; durationColumn;
    @FXML private TableColumn&lt;PrescribedDrug, Void&gt; actionColumn;
    @FXML private TextField medicationSearchField;
    @FXML private ComboBox&lt;Medication&gt; medicationComboBox;
    @FXML private TextField dosageField;
    @FXML private TextField frequencyField;
    @FXML private TextField durationField;
    @FXML private Button addMedicationBtn;
    @FXML private Button newPrescriptionBtn;
    @FXML private Button saveBtn;
    @FXML private Button addPatientBtn;
    @FXML private Button editPatientBtn;
    @FXML private Button refreshBtn;


    // FXML Controls - Alerts Section
    @FXML private Label criticalAlertsLabel;
    @FXML private Label warningAlertsLabel;
    @FXML private Label infoAlertsLabel;
    @FXML private ListView&lt;InteractionAlert&gt; alertsListView;
    @FXML private TextArea alertDetailsTextArea;
    @FXML private Button acknowledgeAlertBtn;

    // FXML Controls - Status Bar
    @FXML private Label statusLabel;
    @FXML private Label prescriptionStatusLabel;
    @FXML private Label interactionStatusLabel;

    // Services and Data
    private DataService dataService;
    private InteractionEngine interactionEngine;
    private Patient selectedPatient;

    private Prescription currentPrescription;
<span class="nc" id="L87">    private final ObservableList&lt;Patient&gt; patientList = FXCollections.observableArrayList();</span>
<span class="nc" id="L88">    private final ObservableList&lt;Medication&gt; medicationList = FXCollections.observableArrayList();</span>
<span class="nc" id="L89">    private final ObservableList&lt;InteractionAlert&gt; alertList = FXCollections.observableArrayList();</span>
<span class="nc" id="L90">    private final ObservableList&lt;PrescribedDrug&gt; prescribedDrugList = FXCollections.observableArrayList();</span>

    @Override
    public void initialize(URL location, ResourceBundle resources) {
<span class="nc" id="L94">        dataService = new DataService();</span>
<span class="nc" id="L95">        interactionEngine = new InteractionEngine();</span>

        // Setup UI components
<span class="nc" id="L98">        setupDate();</span>
<span class="nc" id="L99">        loadData();</span>
<span class="nc" id="L100">        setupPatientListView();</span>
<span class="nc" id="L101">        setupMedicationComboBox();</span>
<span class="nc" id="L102">        setupPrescriptionTable();</span>
<span class="nc" id="L103">        setupAlertsListView();</span>
<span class="nc" id="L104">        setupEventListeners();</span>
<span class="nc" id="L105">        updateUIState();</span>
<span class="nc" id="L106">    }</span>
    
    private void setupDate() {
<span class="nc" id="L109">        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;EEEE, MMMM d, yyyy&quot;);</span>
<span class="nc" id="L110">        currentDateLabel.setText(LocalDate.now().format(formatter));</span>
<span class="nc" id="L111">    }</span>

    private void loadData() {
<span class="nc" id="L114">        statusLabel.setText(&quot;Loading data...&quot;);</span>
        try {
<span class="nc" id="L116">            dataService.loadAllData();</span>
<span class="nc" id="L117">            patientList.setAll(dataService.getAllPatients());</span>
<span class="nc" id="L118">            medicationList.setAll(dataService.getAllMedications());</span>
<span class="nc" id="L119">            statusLabel.setText(&quot;Data loaded successfully.&quot;);</span>
<span class="nc" id="L120">        } catch (Exception e) {</span>
<span class="nc" id="L121">            statusLabel.setText(&quot;Error loading data.&quot;);</span>
<span class="nc" id="L122">            showErrorAlert(&quot;Data Loading Error&quot;, &quot;Could not load application data files.&quot;, e.getMessage());</span>
<span class="nc" id="L123">        }</span>
<span class="nc" id="L124">    }</span>

    //--- Event Handlers ---//
    @FXML
    private void handleAddPatient() {
<span class="nc" id="L129">        Patient newPatient = new Patient();</span>
<span class="nc" id="L130">        boolean saved = showPatientDialog(newPatient, &quot;Add New Patient&quot;);</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (saved) {</span>
            // In a real app, you'd save this to a persistent source via the service
            // For now, just add to the in-memory list
<span class="nc" id="L134">            dataService.getAllPatients().add(newPatient); // A bit of a hack for demo</span>
<span class="nc" id="L135">            patientList.add(newPatient);</span>
<span class="nc" id="L136">            patientListView.getSelectionModel().select(newPatient);</span>
        }
<span class="nc" id="L138">    }</span>

    @FXML
    private void handleEditPatient() {
<span class="nc bnc" id="L142" title="All 2 branches missed.">        if (selectedPatient == null) {</span>
<span class="nc" id="L143">            showWarningAlert(&quot;No Patient Selected&quot;, &quot;Please select a patient to edit.&quot;);</span>
<span class="nc" id="L144">            return;</span>
        }
<span class="nc" id="L146">        boolean saved = showPatientDialog(selectedPatient, &quot;Edit Patient&quot;);</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">        if (saved) {</span>
            // The list view cell is bound to the patient's name property, but a full
            // refresh ensures all changes are reflected if the cell factory were more complex.
<span class="nc" id="L150">            patientListView.refresh();</span>
            // Re-update the panel to show any changed info
<span class="nc" id="L152">            updatePatientInfoPanel();</span>
        }
<span class="nc" id="L154">    }</span>

    private boolean showPatientDialog(Patient patient, String title) {
        try {
<span class="nc" id="L158">            FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;/fxml/PatientDialog.fxml&quot;));</span>
<span class="nc" id="L159">            VBox page = loader.load();</span>

<span class="nc" id="L161">            Stage dialogStage = new Stage();</span>
<span class="nc" id="L162">            dialogStage.setTitle(title);</span>
<span class="nc" id="L163">            dialogStage.initModality(Modality.WINDOW_MODAL);</span>
<span class="nc" id="L164">            dialogStage.initOwner(patientListView.getScene().getWindow());</span>
<span class="nc" id="L165">            Scene scene = new Scene(page);</span>
<span class="nc" id="L166">            dialogStage.setScene(scene);</span>

<span class="nc" id="L168">            PatientDialogController controller = loader.getController();</span>
<span class="nc" id="L169">            controller.setDialogStage(dialogStage);</span>
<span class="nc" id="L170">            controller.setPatient(patient);</span>

<span class="nc" id="L172">            dialogStage.showAndWait();</span>

<span class="nc" id="L174">            return controller.isSaved();</span>
<span class="nc" id="L175">        } catch (IOException e) {</span>
<span class="nc" id="L176">            e.printStackTrace();</span>
<span class="nc" id="L177">            showErrorAlert(&quot;Dialog Error&quot;, &quot;Could not load the patient dialog.&quot;, e.getMessage());</span>
<span class="nc" id="L178">            return false;</span>
        }
    }

    private void setupPatientListView() {
<span class="nc" id="L183">        patientListView.setItems(patientList);</span>
<span class="nc" id="L184">        patientListView.setCellFactory(lv -&gt; new ListCell&lt;&gt;() {</span>
            @Override
            protected void updateItem(Patient patient, boolean empty) {
<span class="nc" id="L187">                super.updateItem(patient, empty);</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">                setText(empty ? null : patient.getFullName());</span>
<span class="nc" id="L189">            }</span>
        });
<span class="nc" id="L191">    }</span>

    private void setupMedicationComboBox() {
<span class="nc" id="L194">        medicationComboBox.setItems(medicationList);</span>
<span class="nc" id="L195">        Callback&lt;ListView&lt;Medication&gt;, ListCell&lt;Medication&gt;&gt; cellFactory = lv -&gt; new ListCell&lt;&gt;() {</span>
            @Override
            protected void updateItem(Medication med, boolean empty) {
<span class="nc" id="L198">                super.updateItem(med, empty);</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">                setText(empty ? null : med.getDisplayName() + &quot; (&quot; + med.getGenericName() + &quot;)&quot;);</span>
<span class="nc" id="L200">            }</span>
        };
<span class="nc" id="L202">        medicationComboBox.setCellFactory(cellFactory);</span>
<span class="nc" id="L203">        medicationComboBox.setButtonCell(cellFactory.call(null));</span>
<span class="nc" id="L204">    }</span>

    private void setupPrescriptionTable() {
<span class="nc" id="L207">        medicationColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getMedication().getDisplayName()));</span>
<span class="nc" id="L208">        dosageColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;dosage&quot;));</span>
<span class="nc" id="L209">        frequencyColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;frequency&quot;));</span>
<span class="nc" id="L210">        durationColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;duration&quot;));</span>
<span class="nc" id="L211">        prescriptionTableView.setItems(prescribedDrugList);</span>
<span class="nc" id="L212">        setupActionColumn();</span>
<span class="nc" id="L213">    }</span>

    private void setupActionColumn() {
<span class="nc" id="L216">        actionColumn.setCellFactory(param -&gt; new TableCell&lt;&gt;() {</span>
<span class="nc" id="L217">            private final Button removeBtn = new Button(&quot;Remove&quot;);</span>
            {
<span class="nc" id="L219">                removeBtn.getStyleClass().add(&quot;danger-button&quot;);</span>
<span class="nc" id="L220">                removeBtn.setOnAction(event -&gt; {</span>
<span class="nc" id="L221">                    PrescribedDrug drug = getTableView().getItems().get(getIndex());</span>
<span class="nc" id="L222">                    handleRemoveMedication(drug);</span>
<span class="nc" id="L223">                });</span>
<span class="nc" id="L224">            }</span>
            @Override
            protected void updateItem(Void item, boolean empty) {
<span class="nc" id="L227">                super.updateItem(item, empty);</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">                setGraphic(empty ? null : removeBtn);</span>
<span class="nc" id="L229">            }</span>
        });
<span class="nc" id="L231">    }</span>

    private void setupAlertsListView() {
<span class="nc" id="L234">        alertsListView.setItems(alertList);</span>
<span class="nc" id="L235">        alertsListView.setCellFactory(lv -&gt; new ListCell&lt;&gt;() {</span>
            @Override
            protected void updateItem(InteractionAlert alert, boolean empty) {
<span class="nc" id="L238">                super.updateItem(alert, empty);</span>
<span class="nc bnc" id="L239" title="All 4 branches missed.">                if (empty || alert == null) {</span>
<span class="nc" id="L240">                    setText(null);</span>
<span class="nc" id="L241">                    getStyleClass().removeAll(&quot;alert-critical&quot;, &quot;alert-warning&quot;, &quot;alert-info&quot;);</span>
<span class="nc" id="L242">                    setOpacity(1.0);</span>
                } else {
<span class="nc" id="L244">                    setText(String.format(&quot;[%s] %s&quot;, alert.getAlertLevel(), alert.getAlertType()));</span>
<span class="nc" id="L245">                    getStyleClass().removeAll(&quot;alert-critical&quot;, &quot;alert-warning&quot;, &quot;alert-info&quot;);</span>
                    // Add the correct class based on alert level
<span class="nc bnc" id="L247" title="All 4 branches missed.">                    switch (alert.getAlertLevel()) {</span>
<span class="nc" id="L248">                        case CRITICAL -&gt; getStyleClass().add(&quot;alert-critical&quot;);</span>
<span class="nc" id="L249">                        case WARNING -&gt; getStyleClass().add(&quot;alert-warning&quot;);</span>
<span class="nc" id="L250">                        case INFO -&gt; getStyleClass().add(&quot;alert-info&quot;);</span>
                    }
<span class="nc bnc" id="L252" title="All 2 branches missed.">                    setOpacity(alert.isAcknowledged() ? 0.6 : 1.0);</span>
                }
<span class="nc" id="L254">            }</span>
        });
<span class="nc" id="L256">    }</span>

    private void setupEventListeners() {
<span class="nc" id="L259">        patientListView.getSelectionModel().selectedItemProperty().addListener(</span>
<span class="nc" id="L260">            (obs, oldVal, newVal) -&gt; handlePatientSelection(newVal));</span>

<span class="nc" id="L262">        alertsListView.getSelectionModel().selectedItemProperty().addListener(</span>
<span class="nc" id="L263">            (obs, oldVal, newVal) -&gt; handleAlertSelection(newVal));</span>

<span class="nc" id="L265">        patientSearchField.textProperty().addListener(</span>
<span class="nc" id="L266">            (obs, oldVal, newVal) -&gt; patientList.setAll(dataService.searchPatients(newVal)));</span>

<span class="nc" id="L268">        medicationSearchField.textProperty().addListener(</span>
<span class="nc" id="L269">            (obs, oldVal, newVal) -&gt; medicationComboBox.setItems(</span>
<span class="nc" id="L270">                FXCollections.observableArrayList(dataService.searchMedications(newVal))));</span>
<span class="nc" id="L271">    }</span>

    @FXML
    private void handlePatientSelection(Patient patient) {
<span class="nc" id="L275">        selectedPatient = patient;</span>
<span class="nc" id="L276">        clearPrescription();</span>
<span class="nc" id="L277">        updatePatientInfoPanel();</span>
<span class="nc" id="L278">        updateUIState();</span>
<span class="nc" id="L279">    }</span>

    private void handleAlertSelection(InteractionAlert alert) {
<span class="nc bnc" id="L282" title="All 2 branches missed.">        if (alert != null) {</span>
<span class="nc" id="L283">            alertDetailsTextArea.setText(alert.getFormattedMessage());</span>
<span class="nc" id="L284">            acknowledgeAlertBtn.setDisable(alert.isAcknowledged());</span>
        } else {
<span class="nc" id="L286">            alertDetailsTextArea.clear();</span>
<span class="nc" id="L287">            acknowledgeAlertBtn.setDisable(true);</span>
        }
<span class="nc" id="L289">    }</span>

    @FXML
    private void handleNewPrescription() {
<span class="nc bnc" id="L293" title="All 2 branches missed.">        if (selectedPatient == null) {</span>
<span class="nc" id="L294">            showWarningAlert(&quot;No Patient Selected&quot;, &quot;Please select a patient before starting a new prescription.&quot;);</span>
<span class="nc" id="L295">            return;</span>
        }
<span class="nc" id="L297">        currentPrescription = new Prescription(selectedPatient, &quot;Dr. User&quot;);</span>
<span class="nc" id="L298">        clearPrescriptionForm();</span>
<span class="nc" id="L299">        prescribedDrugList.clear();</span>
<span class="nc" id="L300">        alertList.clear();</span>
<span class="nc" id="L301">        updateAlertsSummary();</span>
<span class="nc" id="L302">        updateUIState();</span>
<span class="nc" id="L303">        statusLabel.setText(&quot;New prescription started for &quot; + selectedPatient.getFullName());</span>
<span class="nc" id="L304">    }</span>

    @FXML
    private void handleRefresh() {
<span class="nc" id="L308">        loadData();</span>
<span class="nc bnc" id="L309" title="All 4 branches missed.">        if (currentPrescription != null &amp;&amp; selectedPatient != null) {</span>
<span class="nc" id="L310">            checkInteractions();</span>
        }
<span class="nc" id="L312">    }</span>

    @FXML
    private void handlePatientSearch() {
<span class="nc" id="L316">        String searchTerm = patientSearchField.getText();</span>
<span class="nc" id="L317">        patientList.setAll(dataService.searchPatients(searchTerm));</span>
<span class="nc" id="L318">    }</span>


    @FXML
    private void handleAddMedication() {
<span class="nc bnc" id="L323" title="All 2 branches missed.">        if (currentPrescription == null) {</span>
<span class="nc" id="L324">            showWarningAlert(&quot;No Active Prescription&quot;, &quot;Please start a new prescription before adding medications.&quot;);</span>
<span class="nc" id="L325">            return;</span>
        }

<span class="nc" id="L328">        Medication selectedMed = medicationComboBox.getValue();</span>
<span class="nc" id="L329">        String dosage = dosageField.getText().trim();</span>
<span class="nc" id="L330">        String frequency = frequencyField.getText().trim();</span>
<span class="nc" id="L331">        String duration = durationField.getText().trim();</span>

<span class="nc bnc" id="L333" title="All 8 branches missed.">        if (selectedMed == null || dosage.isEmpty() || frequency.isEmpty() || duration.isEmpty()) {</span>
<span class="nc" id="L334">            showWarningAlert(&quot;Missing Information&quot;, &quot;Please select a medication and fill in all dosage fields.&quot;);</span>
<span class="nc" id="L335">            return;</span>
        }

<span class="nc bnc" id="L338" title="All 2 branches missed.">        if (!selectedMed.isValidDosage(dosage)) {</span>
<span class="nc" id="L339">            showWarningAlert(&quot;Invalid Dosage&quot;, &quot;The dosage format is not valid for this type of medication. Example: '1' for tablets, '5ml' for liquids.&quot;);</span>
<span class="nc" id="L340">            return;</span>
        }

<span class="nc" id="L343">        PrescribedDrug newDrug = new PrescribedDrug(selectedMed, dosage, frequency, duration, &quot;&quot;, &quot;Dr. User&quot;);</span>
<span class="nc" id="L344">        currentPrescription.addPrescribedDrug(newDrug);</span>
<span class="nc" id="L345">        prescribedDrugList.setAll(currentPrescription.getPrescribedDrugs());</span>
<span class="nc" id="L346">        clearPrescriptionForm();</span>
<span class="nc" id="L347">        checkInteractions();</span>
<span class="nc" id="L348">    }</span>

    private void handleRemoveMedication(PrescribedDrug drug) {
<span class="nc bnc" id="L351" title="All 2 branches missed.">        if (currentPrescription != null) {</span>
<span class="nc" id="L352">            currentPrescription.removePrescribedDrug(drug);</span>
<span class="nc" id="L353">            prescribedDrugList.setAll(currentPrescription.getPrescribedDrugs());</span>
<span class="nc" id="L354">            checkInteractions();</span>
        }
<span class="nc" id="L356">    }</span>

    @FXML
    private void handleAcknowledgeAlert() {
<span class="nc" id="L360">        InteractionAlert selectedAlert = alertsListView.getSelectionModel().getSelectedItem();</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">        if (selectedAlert != null) {</span>
<span class="nc" id="L362">            selectedAlert.acknowledge();</span>
<span class="nc" id="L363">            alertsListView.refresh();</span>
<span class="nc" id="L364">            acknowledgeAlertBtn.setDisable(true);</span>
        }
<span class="nc" id="L366">    }</span>

    @FXML
    private void handleSave() {
<span class="nc bnc" id="L370" title="All 4 branches missed.">        if (currentPrescription != null &amp;&amp; !currentPrescription.isEmpty()) {</span>
            // Check for unacknowledged critical alerts before saving
<span class="nc" id="L372">            boolean hasUnacknowledgedCritical = alertList.stream()</span>
<span class="nc bnc" id="L373" title="All 4 branches missed.">                .anyMatch(a -&gt; a.getAlertLevel() == AlertLevel.CRITICAL &amp;&amp; !a.isAcknowledged());</span>

<span class="nc bnc" id="L375" title="All 2 branches missed.">            if (hasUnacknowledgedCritical) {</span>
<span class="nc" id="L376">                showWarningAlert(&quot;Unacknowledged Critical Alerts&quot;, &quot;You must acknowledge all critical alerts before saving the prescription.&quot;);</span>
<span class="nc" id="L377">                return;</span>
            }

<span class="nc" id="L380">            currentPrescription.setStatus(PrescriptionStatus.APPROVED);</span>
<span class="nc" id="L381">            statusLabel.setText(&quot;Prescription saved and approved.&quot;);</span>
<span class="nc" id="L382">            showInfoAlert(&quot;Success&quot;, &quot;Prescription has been saved.&quot;);</span>
<span class="nc" id="L383">            updateUIState();</span>

<span class="nc" id="L385">        } else {</span>
<span class="nc" id="L386">            showWarningAlert(&quot;Cannot Save&quot;, &quot;There is no active or non-empty prescription to save.&quot;);</span>
        }
<span class="nc" id="L388">    }</span>

    private void checkInteractions() {
<span class="nc bnc" id="L391" title="All 6 branches missed.">        if (selectedPatient == null || currentPrescription == null || currentPrescription.isEmpty()) {</span>
<span class="nc" id="L392">            alertList.clear();</span>
<span class="nc" id="L393">            updateAlertsSummary();</span>
<span class="nc" id="L394">            interactionStatusLabel.setText(&quot;Interactions: N/A&quot;);</span>
<span class="nc" id="L395">            return;</span>
        }

<span class="nc" id="L398">        interactionStatusLabel.setText(&quot;Checking interactions...&quot;);</span>
<span class="nc" id="L399">        CompletableFuture&lt;List&lt;InteractionAlert&gt;&gt; future = interactionEngine.checkAllInteractionsAsync(selectedPatient, currentPrescription, dataService.getInteractionRules());</span>

<span class="nc" id="L401">        future.thenAccept(alerts -&gt; Platform.runLater(() -&gt; {</span>
<span class="nc" id="L402">                alertList.setAll(alerts);</span>
<span class="nc" id="L403">                updateAlertsSummary();</span>
<span class="nc" id="L404">                interactionStatusLabel.setText(&quot;Interactions checked.&quot;);</span>
<span class="nc" id="L405">            }))</span>
<span class="nc" id="L406">            .exceptionally(ex -&gt; {</span>
<span class="nc" id="L407">                Platform.runLater(() -&gt; {</span>
<span class="nc" id="L408">                    interactionStatusLabel.setText(&quot;Error checking interactions.&quot;);</span>
<span class="nc" id="L409">                    showErrorAlert(&quot;Interaction Engine Error&quot;, &quot;An error occurred while checking for interactions.&quot;, ex.getMessage());</span>
<span class="nc" id="L410">                });</span>
<span class="nc" id="L411">                return null;</span>
            });
<span class="nc" id="L413">    }</span>

    private void updateUIState() {
<span class="nc bnc" id="L416" title="All 2 branches missed.">        boolean patientSelected = selectedPatient != null;</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">        newPrescriptionBtn.setDisable(!patientSelected);</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">        editPatientBtn.setDisable(!patientSelected);</span>

<span class="nc bnc" id="L420" title="All 4 branches missed.">        boolean prescriptionActive = currentPrescription != null &amp;&amp; currentPrescription.getStatus() == PrescriptionStatus.DRAFT;</span>
<span class="nc bnc" id="L421" title="All 2 branches missed.">        addMedicationBtn.setDisable(!prescriptionActive);</span>
<span class="nc bnc" id="L422" title="All 4 branches missed.">        saveBtn.setDisable(!prescriptionActive || currentPrescription.isEmpty());</span>

<span class="nc bnc" id="L424" title="All 2 branches missed.">        prescriptionStatusLabel.setText(currentPrescription != null ?</span>
<span class="nc" id="L425">            &quot;Prescription Status: &quot; + currentPrescription.getStatus() :</span>
<span class="nc" id="L426">            &quot;No active prescription&quot;);</span>
        
<span class="nc" id="L428">        medicationCountLabel.setText(prescribedDrugList.size() + &quot; medications&quot;);</span>
<span class="nc" id="L429">    }</span>

    private void updatePatientInfoPanel() {
<span class="nc bnc" id="L432" title="All 2 branches missed.">        if (selectedPatient != null) {</span>
<span class="nc" id="L433">            selectedPatientLabel.setText(selectedPatient.getFullName());</span>
<span class="nc" id="L434">            patientIdLabel.setText(selectedPatient.getPatientId());</span>
<span class="nc" id="L435">            patientAgeLabel.setText(&quot;Age: &quot; + selectedPatient.getAge());</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">            patientGenderLabel.setText(&quot;Gender: &quot; + (selectedPatient.getGender() != null ? selectedPatient.getGender() : &quot;N/A&quot;));</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">            patientAllergiesLabel.setText(&quot;Allergies: &quot; + (!selectedPatient.getAllergies().isEmpty() ? String.join(&quot;, &quot;, selectedPatient.getAllergies()) : &quot;None&quot;));</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">            patientConditionsLabel.setText(&quot;Conditions: &quot; + (!selectedPatient.getChronicConditions().isEmpty() ? String.join(&quot;, &quot;, selectedPatient.getChronicConditions()) : &quot;None reported&quot;));</span>
        } else {
<span class="nc" id="L440">            selectedPatientLabel.setText(&quot;No Patient Selected&quot;);</span>
<span class="nc" id="L441">            patientIdLabel.setText(&quot;&quot;);</span>
<span class="nc" id="L442">            patientAgeLabel.setText(&quot;Age: N/A&quot;);</span>
<span class="nc" id="L443">            patientGenderLabel.setText(&quot;Gender: N/A&quot;);</span>
<span class="nc" id="L444">            patientAllergiesLabel.setText(&quot;Allergies: None&quot;);</span>
<span class="nc" id="L445">            patientConditionsLabel.setText(&quot;Conditions: None reported&quot;);</span>
        }
<span class="nc" id="L447">    }</span>

    private void updateAlertsSummary() {
<span class="nc" id="L450">        long criticalCount = interactionEngine.getCriticalAlertCount(alertList);</span>
<span class="nc" id="L451">        long warningCount = interactionEngine.getWarningAlertCount(alertList);</span>
<span class="nc" id="L452">        long infoCount = interactionEngine.getInfoAlertCount(alertList);</span>
        
<span class="nc" id="L454">        criticalAlertsLabel.setText(String.valueOf(criticalCount));</span>
<span class="nc" id="L455">        warningAlertsLabel.setText(String.valueOf(warningCount));</span>
<span class="nc" id="L456">        infoAlertsLabel.setText(String.valueOf(infoCount));</span>
<span class="nc" id="L457">    }</span>

    private void clearPrescription() {
<span class="nc" id="L460">        currentPrescription = null;</span>
<span class="nc" id="L461">        prescribedDrugList.clear();</span>
<span class="nc" id="L462">        alertList.clear();</span>
<span class="nc" id="L463">        updateAlertsSummary();</span>
<span class="nc" id="L464">        clearPrescriptionForm();</span>
<span class="nc" id="L465">        updateUIState();</span>
<span class="nc" id="L466">    }</span>

    private void clearPrescriptionForm() {
<span class="nc" id="L469">        medicationComboBox.setValue(null);</span>
<span class="nc" id="L470">        medicationSearchField.clear();</span>
<span class="nc" id="L471">        dosageField.clear();</span>
<span class="nc" id="L472">        frequencyField.clear();</span>
<span class="nc" id="L473">        durationField.clear();</span>
<span class="nc" id="L474">    }</span>

    public void shutdown() {
<span class="nc bnc" id="L477" title="All 2 branches missed.">        if (interactionEngine != null) {</span>
<span class="nc" id="L478">            interactionEngine.shutdown();</span>
        }
<span class="nc" id="L480">    }</span>

    private void showWarningAlert(String title, String content) {
<span class="nc" id="L483">        Alert alert = new Alert(Alert.AlertType.WARNING);</span>
<span class="nc" id="L484">        alert.setTitle(title);</span>
<span class="nc" id="L485">        alert.setHeaderText(null);</span>
<span class="nc" id="L486">        alert.setContentText(content);</span>
<span class="nc" id="L487">        alert.showAndWait();</span>
<span class="nc" id="L488">    }</span>

    private void showErrorAlert(String title, String header, String content) {
<span class="nc" id="L491">        Alert alert = new Alert(Alert.AlertType.ERROR);</span>
<span class="nc" id="L492">        alert.setTitle(title);</span>
<span class="nc" id="L493">        alert.setHeaderText(header);</span>
<span class="nc" id="L494">        alert.setContentText(content);</span>
<span class="nc" id="L495">        alert.showAndWait();</span>
<span class="nc" id="L496">    }</span>

    private void showInfoAlert(String title, String content) {
<span class="nc" id="L499">        Alert alert = new Alert(Alert.AlertType.INFORMATION);</span>
<span class="nc" id="L500">        alert.setTitle(title);</span>
<span class="nc" id="L501">        alert.setHeaderText(null);</span>
<span class="nc" id="L502">        alert.setContentText(content);</span>
<span class="nc" id="L503">        alert.showAndWait();</span>
<span class="nc" id="L504">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>